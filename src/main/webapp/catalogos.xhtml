<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">
    <ui:define name="title">Catalogos</ui:define>
    <ui:define name="viewname">
        <li>Admin</li>
        <li>/</li>
        <li>
            <p:link outcome="/catalogos">Catalogos</p:link>
        </li>
    </ui:define>

    <ui:define name="content">
        <h:form id="frmCatalogos">
            <div class="layout-dashboard">
                <div class="grid">           
                    <div class="col-12 md:col-12 lg:col-12">
                        <div class="card">
                            <h4>ADMINISTRACION DE CATÁLOGOS</h4>
                            <p:treeTable value="#{catalogoController.root}" var="catalogo" 
                                         showGridlines="true" editable="true" id="trTblCatalogo">
                                <p:ajax event="rowEdit" listener="#{catalogoController.onRowEdit}" update="msgs"/>
                                <p:ajax event="rowEditCancel" listener="#{catalogoController.onRowCancel}" update="msgs"/>

                                <p:column headerText="ID" sortBy="#{catalogo.id}" style="width: 7%;" responsivePriority="1">                                
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{catalogo.id}"/></f:facet>
                                        <f:facet name="input"><p:inputText value="#{catalogo.id}" style="width:100%" disabled="true"/></f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column headerText="NOMBRE" sortBy="#{catalogo.nombre}" styleClass="w-auto" responsivePriority="1">                                
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{catalogo.nombre}"/></f:facet>
                                        <f:facet name="input"><p:inputText value="#{catalogo.nombre}" style="width:100%" onkeyup="value = value.toUpperCase()"/></f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column headerText="ORDEN"  style="width: 5%;" responsivePriority="3">                                
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{catalogo.orden}"/></f:facet>
                                        <f:facet name="input"><p:inputText value="#{catalogo.orden}" style="width:100%"/></f:facet>
                                    </p:cellEditor>
                                </p:column>                            

                                <p:column headerText="DESCRIPCIÓN" styleClass="w-auto" responsivePriority="4">
                                    <p:cellEditor>
                                        <f:facet name="output"><h:outputText value="#{catalogo.descripcion}"/></f:facet>
                                        <f:facet name="input"><p:inputText value="#{catalogo.descripcion}" style="width:100%" onkeyup="value = value.toUpperCase()"/></f:facet>
                                    </p:cellEditor>                                
                                </p:column>

                                <p:column style="width: 5%;" responsivePriority="5">
                                    <f:facet name="header">                                                                         
                                        <p:commandButton value="Nuevo" icon="pi pi-plus" actionListener="#{catalogoController.nuevoCatalogo}" update="frmCatalogos:outPnlCatalogo" oncomplete="PF('dlgCatalogo').show()"
                                                         styleClass="ui-button-success" style="margin-right: .5rem" />                             
                                    </f:facet>
                                    <p:rowEditor />
                                    <p:commandButton class="ui-button-warning rounded-button" icon="pi pi-trash" process="@this" oncomplete="PF('dlgEliminaRegistro').show()" >
                                        <f:setPropertyActionListener value="#{catalogo}" target="#{catalogoController.catalogoSeleccionado}" />
                                    </p:commandButton>
                                </p:column>
                            </p:treeTable>
                        </div>
                    </div>
                </div>

                <p:dialog header="Detalles Catalog" showEffect="fade" modal="true" widgetVar="dlgCatalogo" responsive="true">
                    <p:outputPanel id="outPnlCatalogo" class="ui-fluid">
                        <p:outputPanel rendered="#{catalogoController.catalogoSeleccionado ne null}">

                            <div class="field">
                                <p:outputLabel for="nombre" value="Nombres" />
                                <p:inputText id="nombre" value="#{catalogoController.catalogoSeleccionado.nombre}"  maxlength="100" required="true" onkeyup="value = value.toUpperCase()"/>
                            </div>

                            <div class="field">
                                <p:outputLabel for="orden" value="Orden" />
                                <p:inputText id="orden" value="#{catalogoController.catalogoSeleccionado.orden}"  required="true"/>
                            </div>
                            <div class="field">
                                <p:outputLabel for="descripcion" value="Descripción" />
                                <p:inputText id="descripcion" value="#{catalogoController.catalogoSeleccionado.descripcion}"  maxlength="150" required="true" onkeyup="value = value.toUpperCase()"/>
                            </div>
                            <div class="field">
                                <p:outputLabel for="padre" value="Padre" />
                                <p:inputText id="padre" value="#{catalogoController.catalogoSeleccionado.padre.id}"  required="true"/>
                            </div>
                        </p:outputPanel>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton value="Guardar" icon="pi pi-check" actionListener="#{catalogoController.guardarCatalogo}" update="outPnlCatalogo, msgs" process="outPnlCatalogo @this" />                                 
                        <p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('dlgCatalogo').hide()" class="ui-button-secondary" />
                    </f:facet>
                </p:dialog>         

                <p:confirmDialog global="true" showEffect="fade" width="300">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
                </p:confirmDialog>

                <p:confirmDialog widgetVar="dlgEliminaRegistro" showEffect="fade" width="300" message="¿Está seguro que desea eliminar?" header="Confirm" severity="warn">
                    <p:commandButton value="Si" icon="pi pi-check" actionListener="#{catalogoController.eliminarCatalogoSeleccionado}" process="@this" oncomplete="PF('dlgEliminaRegistro').hide()"/>
                    <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times" onclick="PF('dlgEliminaRegistro').hide()" />
                </p:confirmDialog>
            </div>
        </h:form>
    </ui:define>
</ui:composition>

